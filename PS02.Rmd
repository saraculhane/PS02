---
title: "STAT/MATH 495: Problem Set 02"
author: "Sara Culhane"
date: "2017-09-19"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 2
    collapsed: false
    smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=8, fig.height=4.5)

# Load packages
library(tidyverse)
library(dplyr)
library(mosaic)
library(broom)
require(splines)
# Note the relative file path, and not absolute file path:
# http://www.coffeecup.com/help/articles/absolute-vs-relative-pathslinks/
train <- read_csv("train.csv")
test <- read_csv("test.csv")
train$USD <- (train$price_doc)*0.017 # convert to USD
```


# Exploratory Data Analysis

```{r, include=FALSE}
glimpse(train)
a <- ggplot(train, aes(price_doc))
a + geom_density()
```

Looking at the distribution of housing prices, they were right skewed with a median of 6,274,411 Russian Rubles (determine they were Rubles based on currency conversions).

To choose a predictor we looked at several ggplots and determined that full_sq would be a resonable example though we did not do an exhaustive search. We also removed all observations over 2000 square feet but ulimately this only improved our Kaggle score slightly.  However, it greatly improved the correlation between the response and predictor.

```{r}
train2 <- train[train$full_sq < 2000,]
ggplot(train2, aes(x=full_sq, y=price_doc)) + geom_point()
cor(train2$full_sq,train2$price_doc)
cor(train$full_sq,train$price_doc)
```

## Spline Visualization

```{r}
values <- data_frame(
  x = train2$full_sq,
  y = train2$price_doc
)


values %>% 
  ggplot(aes(x=x)) +
  geom_point(aes(y=y))
smooth.spline(values$x, values$y, df=20) %>%
  broom::augment() %>% 
  ggplot(aes(x=x)) +
  geom_point(aes(y=y)) +
  geom_line(aes(y=.fitted), col="blue", size=1)



```

# Model Fit


```{r}
fit<-lm(y ~ bs(x,df=20),data = values )
summary(fit)
f <- makeFun(fit)
test$price_doc <- f(test$full_sq)
sub  <- test[,c(1,length(test))]

```


# Create Submission File

```{r}
write_csv(sub, "submission.csv")
```

